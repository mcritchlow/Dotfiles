#!/bin/sh
#
# Check for updates in rbenv and plugin folders
if test ! -d "$RBENV_ROOT"; then
  echo "rbenv not installed, aborting"
  exit 1
fi

update_repo() {
  cd "$1" || return
  current_head=$(git log | head -1 | cut -d ' ' -f2)
  current_branch=$(git branch --show-current)

  git pull --quiet origin "$current_branch"

  new_head=$(git log | head -1 | cut -d ' ' -f2)
  if test "$current_head" != "$new_head"; then
    notify-send -t 50000 "RBENV: updated ${d##*/}..."
  fi
}

# Update rbenv
update_repo "${RBENV_ROOT}"
# Update rbenv plugins
for d in "$RBENV_ROOT"/plugins/*; do
  update_repo "$d"
done
