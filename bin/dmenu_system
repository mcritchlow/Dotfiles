#!/bin/bash

# dmenu script for managing systemctl
choices="lock\nreboot\nshutdown"

chosen=$(echo -e "$choices" | dmenu -i -fn monospace:size=12 -p "Systemctl Options")

# commit any sync-stuff changes prior to lock/reboot/shutdown
commit_sync_changes() {
  # return immediately if network is down
  iface=$(ip link show | grep -Eo 'wlp[[:alnum:]]+')
  if ip link show "$iface" | grep -q 'DOWN'; then echo "no internet connection" && return; fi

  cd ~/projects/personal/sync-stuff || return
  changes=$(git status --porcelain=v1 | wc -l)
  if [[ $changes = 0 ]]; then echo "there are no changes to sync" && return; fi
  git add .
  git commit -m "auto-commit"
  git push origin master

}

case "$chosen" in
  lock) commit_sync_changes && slock ;;
  reboot) commit_sync_changes && systemctl reboot ;;
  shutdown) commit_sync_changes && systemctl poweroff -i ;;
esac
